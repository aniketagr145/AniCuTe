# !/bin/python
# -*- coding: utf-8 -*-
"""
    Author: Digvijay Bhosale <digvijayb1729@gmail.com>
    Version: 1.0
    Module: SecureTea
"""

from modules.malware_analysis.fileAnalysis import FileAnalyser
from modules.malware_analysis.malwareAnalysis import MalwareAnalysis
from modules.malware_analysis.continuous_malware_defence import ContinuousDefence
from modules.malware_analysis import globals
from modules.malware_analysis.mal_gui import app_runner


class MalwareAnalysisRunner:
    def __init__(self, creds):
        self.mode = creds['mode']
        self.filename = creds['filename']
        self.virustotal_api_key = creds['virustotal_api_key']
        globals.initialize_colours()

    def runner(self):

        if self.mode.lower() == 'c':
            GUI = True
            globals.initialize_flask()
            thread1 = ContinuousDefence(gui=GUI, API_KEY=self.virustotal_api_key)

            # Start new Thread for MalwareAnalysis
            thread1.start()
            if GUI:
                app_runner()

            thread1.join()

        elif self.mode.lower() == 'm':
            m_analysis = MalwareAnalysis(filename=self.filename, API_KEY=self.virustotal_api_key)
            res = m_analysis.runner()
            return res
        else:
            print(globals.WARNING + 'Incorrect option selected' + globals.END)
            return